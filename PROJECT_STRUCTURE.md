# MTUCI Guesser - Структура проекта

## Обзор

MTUCI Guesser - это игра-геогессер для университета МТУСИ. Игроки угадывают местоположение фотографий внутри главного корпуса университета.

## Реализованный функционал

### 1. Система авторизации и аккаунтов
- **Регистрация** (`RegistrationPage.tsx`) - создание нового аккаунта
- **Вход** (`LoginPage.tsx`) - авторизация пользователя
- **Профиль** (`AccountPage.tsx`) - просмотр и редактирование данных пользователя
- Хеширование паролей с использованием bcrypt
- Сессии для сохранения состояния авторизации

### 2. Игровой процесс
- **Главная страница** (`HomePage.tsx`) - стартовый экран с кнопками начала игры и правил
  - Выпадающее меню профиля для авторизованных пользователей
  - Доступ к аккаунту и выходу через dropdown
- **Страница игры** (`Play.tsx`) - основной геймплей:
  - Просмотр панорамных фотографий локаций
  - **Прокрутка панорамы** - стрелки и перетаскивание мышкой для просмотра 360°
  - Выбор этажа из 5 вариантов
  - Указание точки на карте этажа
  - Зум карты для точного указания местоположения
  - Система раундов (16 раундов)
  - Подсчет очков (0-100 баллов за раунд)
  
- **Страница результата раунда** (`ResultPage.tsx`):
  - Показ результата текущего раунда
  - Отображение правильного ответа и вашей попытки на карте
  - Количество набранных баллов

- **Таблица лидеров** (`LeaderboardPage.tsx`):
  - Топ-10 игроков
  - Общий счет игрока
  - Место в рейтинге
  - Возможность пройти игру заново

### 3. Правила игры
- **Модальное окно правил** (`RulesPage.tsx`) - подробное описание правил игры

### 4. UI компоненты
- **ProfileMenu** (`components/ProfileMenu.tsx`) - выпадающее меню профиля:
  - Кнопка "Аккаунт" (выделена фиолетовым)
  - Кнопка "Выйти" (красным цветом)
  - Стрелка-указатель сверху меню
  - Автоматическое закрытие при клике вне меню

### 5. Административная панель
- **Админ панель** (`Admin.tsx`) - полнофункциональная система управления:
  - **Вкладки**: разделение на "Этажи" и "Локации"
  - **Просмотр всех этажей**:
    - Карточный вид (grid layout) со превью карт
    - Информация: название, здание, уровень, ID, размер изображения
    - Кнопки удаления для каждого этажа
  - **Просмотр всех локаций**:
    - Список со превью фотографий
    - Информация: название, этаж, подсказка, координаты
    - Фильтрация по выбранному этажу
    - Кнопки удаления для каждой локации
  - **Создание этажей**:
    - Форма загрузки карты этажа
    - Указание здания и уровня
  - **Создание локаций**:
    - Выбор этажа
    - Загрузка фотографии
    - Клик на карте для указания координат
    - Опциональная подсказка
  - **Удаление**:
    - Каскадное удаление этажей (с локациями)
    - Подтверждение перед удалением
    - Уведомления об успехе/ошибке
  - **Современный UI**: градиенты, анимации, адаптивный дизайн
  - **Доступ**: только для пользователя `admin@admin.com`

## Технологический стек

### Frontend
- **React** + **TypeScript** - основной фреймворк
- **Vite** - сборщик
- **Axios** - HTTP клиент
- **CSS Modules** - стилизация на основе дизайна Figma

### Backend
- **Express.js** - веб-сервер
- **better-sqlite3** - база данных
- **bcrypt** - хеширование паролей
- **express-session** - управление сессиями
- **multer** - загрузка файлов

## Структура базы данных

### Таблица `users`
```sql
- id: INTEGER PRIMARY KEY
- first_name: TEXT
- last_name: TEXT
- email: TEXT UNIQUE
- password_hash: TEXT
- created_at: DATETIME
```

### Таблица `game_results`
```sql
- id: INTEGER PRIMARY KEY
- user_id: INTEGER (FK -> users)
- total_score: INTEGER
- rounds_played: INTEGER
- played_at: DATETIME
```

### Таблица `floors`
```sql
- id: INTEGER PRIMARY KEY
- name: TEXT
- building: TEXT
- level: TEXT
- image_path: TEXT
- width_px: INTEGER
- height_px: INTEGER
```

### Таблица `locations`
```sql
- id: INTEGER PRIMARY KEY
- floor_id: INTEGER (FK -> floors)
- name: TEXT
- x: INTEGER
- y: INTEGER
- image_path: TEXT
- hint: TEXT
```

## API Endpoints

### Авторизация
- `POST /api/auth/register` - регистрация
- `POST /api/auth/login` - вход
- `GET /api/auth/me` - получить текущего пользователя
- `POST /api/auth/logout` - выход

### Пользователи
- `PUT /api/users/:id` - обновить данные пользователя

### Игра
- `GET /api/floors` - список всех этажей
- `GET /api/locations/random` - случайная локация
- `POST /api/guess` - проверить ответ
- `POST /api/game-results` - сохранить результат игры
- `GET /api/leaderboard` - таблица лидеров

### Админ
- `GET /api/locations` - список всех локаций (с информацией об этажах)
- `POST /api/floors` - добавить этаж
- `POST /api/locations` - добавить локацию
- `DELETE /api/floors/:id` - удалить этаж (каскадное удаление локаций)
- `DELETE /api/locations/:id` - удалить локацию

## Навигация между страницами

Навигация реализована через состояние в главном компоненте `App.tsx`:
- `home` - главная страница
- `login` - страница входа
- `register` - страница регистрации
- `account` - профиль пользователя
- `play` - игровой процесс
- `leaderboard` - таблица лидеров
- `admin` - административная панель

## Игровая механика

1. **Начало игры**: Пользователь может играть без регистрации, но результат не сохранится
2. **Просмотр локации**:
   - Панорамная фотография (360°) - можно прокручивать стрелками или перетаскивать мышкой
   - Плавная прокрутка для детального осмотра
3. **Раунд**: 
   - Игрок выбирает этаж (1-5)
   - Игрок указывает точку на карте
   - Можно зумировать карту для точности
   - Нажимает "Готово"
4. **Подсчет очков**:
   - Максимум 100 баллов за раунд
   - Чем ближе к правильной точке, тем больше баллов
   - Неправильный этаж = минимальные баллы
5. **Завершение**: После 16 раундов показывается общий результат и место в рейтинге

## Дизайн

Дизайн полностью соответствует макетам Figma:
- Цветовая схема: фиолетовый (#372579) и белый
- Шрифт: Montserrat (500, 600)
- Адаптивная верстка для мобильных устройств

## Запуск проекта

### Клиент
```bash
cd client
npm install
npm run dev
```

### Сервер
```bash
cd server
npm install
npm run dev
```

Приложение будет доступно на:
- Frontend: http://localhost:5173
- Backend: http://localhost:3001

